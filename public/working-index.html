<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HOMA FOODS - Dr. Nehru's Nutrition Database</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .glass {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }
        .floating {
            animation: float 3s ease-in-out infinite;
        }
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        /* CRITICAL: Ensure input fields work */
        input {
            pointer-events: auto !important;
            user-select: text !important;
            -webkit-user-select: text !important;
            -moz-user-select: text !important;
            -ms-user-select: text !important;
            cursor: text !important;
        }
        input:focus {
            outline: 2px solid #3b82f6 !important;
            outline-offset: 2px !important;
        }
        /* Ensure modals are interactive - SIMPLIFIED */
        #signup-modal, #login-modal {
            pointer-events: auto !important;
        }
        #signup-modal *, #login-modal * {
            pointer-events: auto !important;
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- Header -->
    <header class="glass shadow-lg">
        <div class="container mx-auto px-4 py-4">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-3">
                    <i class="fas fa-apple-alt text-red-500 text-2xl"></i>
                    <h1 class="text-2xl font-bold text-white">HOMA FOODS</h1>
                </div>
                <div class="flex space-x-4">
                    <button id="signup-btn" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-all">
                        Sign Up
                    </button>
                    <button id="login-btn" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition-all">
                        Login
                    </button>
                    <button id="logout-btn" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition-all hidden">
                        Logout
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Welcome Section -->
    <div id="welcome" class="container mx-auto px-4 py-12">
        <div class="text-center">
            <div class="glass rounded-2xl p-12 card-hover">
                <div class="floating mb-8">
                    <div class="w-32 h-32 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full mx-auto flex items-center justify-center">
                        <i class="fas fa-user-md text-white text-5xl"></i>
                    </div>
                </div>
                <h2 class="text-5xl font-bold text-white mb-6">Welcome to HOMA FOODS</h2>
                <p class="text-xl text-white/80 mb-8">3 Lakh Foods | 7 Continents | 165 Countries</p>
                <p class="text-lg text-white/70 mb-8">Dr. Nehru's HOMA-IR Nutrition System</p>
                <div class="flex justify-center space-x-4">
                    <button id="welcome-signup" class="bg-blue-500 text-white px-8 py-4 rounded-lg hover:bg-blue-600 transition-all text-lg">
                        Get Started - Sign Up
                    </button>
                    <button id="welcome-login" class="bg-green-500 text-white px-8 py-4 rounded-lg hover:bg-green-600 transition-all text-lg">
                        Already a Member - Login
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboard" class="container mx-auto px-4 py-12 hidden">
        <div class="glass rounded-2xl p-8">
            <h2 class="text-3xl font-bold text-white mb-8">Nutrition Dashboard</h2>
            
            <!-- Search Section -->
            <div class="mb-8">
                <h3 class="text-xl font-semibold text-white mb-4">Search Foods</h3>
                <div class="flex space-x-4">
                    <input type="text" id="search-input" placeholder="Try: chicken, biryani, idli, sambar..." 
                           class="flex-1 px-4 py-3 bg-white/20 border border-white/30 rounded-lg text-white placeholder-white/70 focus:outline-none focus:ring-2 focus:ring-blue-400">
                    <button id="search-btn" class="bg-blue-500 text-white px-6 py-3 rounded-lg hover:bg-blue-600 transition-all">
                        Search
                    </button>
                </div>
            </div>

            <!-- Search Results -->
            <div id="search-results" class="space-y-4"></div>
        </div>
    </div>

    <!-- Signup Modal -->
    <div id="signup-modal" class="fixed inset-0 z-50 flex items-center justify-center hidden">
        <div class="glass rounded-2xl p-8 max-w-md w-full mx-4">
            <h3 class="text-2xl font-bold text-white mb-6">Sign Up</h3>
            <form id="signup-form">
                <div class="mb-4">
                    <input type="email" id="signup-email" placeholder="Email" required autocomplete="email"
                           class="w-full px-4 py-3 bg-white/20 border border-white/30 rounded-lg text-white placeholder-white/70 focus:outline-none focus:ring-2 focus:ring-blue-400"
                           style="color: white !important;">
                </div>
                <div class="mb-4">
                    <input type="password" id="signup-password" placeholder="Password (min 3 chars)" required autocomplete="new-password"
                           class="w-full px-4 py-3 bg-white/20 border border-white/30 rounded-lg text-white placeholder-white/70 focus:outline-none focus:ring-2 focus:ring-blue-400"
                           style="color: white !important;">
                </div>
                <div class="mb-4">
                    <input type="password" id="signup-confirm" placeholder="Confirm Password" required autocomplete="new-password"
                           class="w-full px-4 py-3 bg-white/20 border border-white/30 rounded-lg text-white placeholder-white/70 focus:outline-none focus:ring-2 focus:ring-blue-400"
                           style="color: white !important;">
                </div>
                <div class="mb-4">
                    <input type="text" id="signup-name" placeholder="Name (optional)" autocomplete="name"
                           class="w-full px-4 py-3 bg-white/20 border border-white/30 rounded-lg text-white placeholder-white/70 focus:outline-none focus:ring-2 focus:ring-blue-400"
                           style="color: white !important;">
                </div>
                <div class="mb-6">
                    <input type="text" id="signup-phone" placeholder="Phone (optional)" autocomplete="tel"
                           class="w-full px-4 py-3 bg-white/20 border border-white/30 rounded-lg text-white placeholder-white/70 focus:outline-none focus:ring-2 focus:ring-blue-400"
                           style="color: white !important;">
                </div>
                <div class="flex space-x-4">
                    <button type="submit" class="bg-blue-500 text-white px-6 py-3 rounded-lg hover:bg-blue-600 transition-all flex-1">
                        Sign Up
                    </button>
                    <button type="button" id="close-signup" class="bg-white/20 text-white px-6 py-3 rounded-lg hover:bg-white/30 transition-all">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Login Modal -->
    <div id="login-modal" class="fixed inset-0 z-50 flex items-center justify-center hidden">
        <div class="glass rounded-2xl p-8 max-w-md w-full mx-4">
            <h3 class="text-2xl font-bold text-white mb-6">Login</h3>
            <form id="login-form">
                <div class="mb-4">
                    <input type="email" id="login-email" placeholder="Email" required autocomplete="email"
                           class="w-full px-4 py-3 bg-white/20 border border-white/30 rounded-lg text-white placeholder-white/70 focus:outline-none focus:ring-2 focus:ring-green-400"
                           style="color: white !important;">
                </div>
                <div class="mb-6">
                    <input type="password" id="login-password" placeholder="Password" required autocomplete="current-password"
                           class="w-full px-4 py-3 bg-white/20 border border-white/30 rounded-lg text-white placeholder-white/70 focus:outline-none focus:ring-2 focus:ring-green-400"
                           style="color: white !important;">
                </div>
                <div class="flex space-x-4">
                    <button type="submit" class="bg-green-500 text-white px-6 py-3 rounded-lg hover:bg-green-600 transition-all flex-1">
                        Login
                    </button>
                    <button type="button" id="close-login" class="bg-white/20 text-white px-6 py-3 rounded-lg hover:bg-white/30 transition-all">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Loading -->
    <div id="loading" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center hidden">
        <div class="glass rounded-2xl p-8 text-center">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-white mx-auto mb-4"></div>
            <p class="text-white">Loading...</p>
        </div>
    </div>

    <!-- Toast -->
    <div id="toast" class="fixed top-4 right-4 z-50 hidden">
        <div class="bg-white/90 text-gray-800 px-6 py-3 rounded-lg shadow-lg">
            <span id="toast-message"></span>
        </div>
    </div>

    <script>
        // HOMA FOODS Frontend - WORKING VERSION
        class HomaFoodsApp {
            constructor() {
                this.apiUrl = window.location.origin + '/api';
                this.token = localStorage.getItem('homaFoodsToken');
                this.user = null;
                
                console.log('🚀 HOMA FOODS App starting...');
                console.log('🌐 API URL:', this.apiUrl);
                
                this.init();
            }

            init() {
                console.log('🔍 Initializing HOMA FOODS App...');
                this.setupEventListeners();
                this.checkAuthStatus();
                this.loadStats();
                console.log('✅ HOMA FOODS App initialized successfully');
            }

            setupEventListeners() {
                console.log('🔍 Setting up event listeners...');
                
                // Navigation buttons
                document.getElementById('signup-btn').addEventListener('click', () => this.showSignup());
                document.getElementById('login-btn').addEventListener('click', () => this.showLogin());
                document.getElementById('logout-btn').addEventListener('click', () => this.logout());
                document.getElementById('welcome-signup').addEventListener('click', () => this.showSignup());
                document.getElementById('welcome-login').addEventListener('click', () => this.showLogin());
                
                // Modal close buttons
                document.getElementById('close-signup').addEventListener('click', () => this.hideSignup());
                document.getElementById('close-login').addEventListener('click', () => this.hideLogin());
                
                // Forms
                document.getElementById('signup-form').addEventListener('submit', (e) => this.handleSignup(e));
                document.getElementById('login-form').addEventListener('submit', (e) => this.handleLogin(e));
                
                // Search
                document.getElementById('search-btn').addEventListener('click', () => this.handleSearch());
                document.getElementById('search-input').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.handleSearch();
                });
                
                console.log('✅ Event listeners setup complete');
            }

            showSignup() {
                console.log('🔍 Showing signup modal...');
                const modal = document.getElementById('signup-modal');
                modal.classList.remove('hidden');
                
                // Close modal when clicking outside
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        this.hideSignup();
                    }
                });
                
                // Focus on first input
                setTimeout(() => {
                    const emailInput = document.getElementById('signup-email');
                    console.log('🔍 Focusing on email input:', emailInput);
                    if (emailInput) {
                        emailInput.focus();
                        console.log('✅ Email input focused');
                    }
                }, 100);
            }

            hideSignup() {
                document.getElementById('signup-modal').classList.add('hidden');
                document.getElementById('signup-form').reset();
            }

            showLogin() {
                console.log('🔍 Showing login modal...');
                const modal = document.getElementById('login-modal');
                modal.classList.remove('hidden');
                
                // Close modal when clicking outside
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        this.hideLogin();
                    }
                });
                
                // Focus on first input
                setTimeout(() => {
                    const emailInput = document.getElementById('login-email');
                    console.log('🔍 Focusing on login email input:', emailInput);
                    if (emailInput) {
                        emailInput.focus();
                        console.log('✅ Login email input focused');
                    }
                }, 100);
            }

            hideLogin() {
                document.getElementById('login-modal').classList.add('hidden');
                document.getElementById('login-form').reset();
            }

            showDashboard() {
                document.getElementById('welcome').classList.add('hidden');
                document.getElementById('dashboard').classList.remove('hidden');
                document.getElementById('signup-btn').classList.add('hidden');
                document.getElementById('login-btn').classList.add('hidden');
                document.getElementById('logout-btn').classList.remove('hidden');
            }

            showWelcome() {
                document.getElementById('welcome').classList.remove('hidden');
                document.getElementById('dashboard').classList.add('hidden');
                document.getElementById('signup-btn').classList.remove('hidden');
                document.getElementById('login-btn').classList.remove('hidden');
                document.getElementById('logout-btn').classList.add('hidden');
            }

            showLoading(show) {
                document.getElementById('loading').classList.toggle('hidden', !show);
            }

            showToast(message, type = 'info') {
                const toast = document.getElementById('toast');
                const messageEl = document.getElementById('toast-message');
                messageEl.textContent = message;
                toast.classList.remove('hidden');
                setTimeout(() => toast.classList.add('hidden'), 3000);
            }

            async handleSignup(e) {
                console.log('🔍 Handle signup called - form submitted!');
                e.preventDefault();
                
                try {
                    const email = document.getElementById('signup-email').value;
                    const password = document.getElementById('signup-password').value;
                    const confirmPassword = document.getElementById('signup-confirm').value;
                    const name = document.getElementById('signup-name').value || '';
                    const phone = document.getElementById('signup-phone').value || '';
                    
                    console.log('🔍 Signup data:', { email, password, confirmPassword, name, phone });
                    console.log('🔍 API URL:', this.apiUrl);
                    
                    // Simple validation
                    if (password !== confirmPassword) {
                        this.showToast('Passwords do not match!', 'error');
                        return;
                    }
                    
                    if (password.length < 3) {
                        this.showToast('Password must be at least 3 characters!', 'error');
                        return;
                    }

                    this.showLoading(true);
                    
                    const response = await fetch(`${this.apiUrl}/auth/signup`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ email, password, confirmPassword, name, phone })
                    });
                    
                    const data = await response.json();
                    console.log('🔍 Signup response:', data);
                    
                    if (response.ok) {
                        this.token = data.token;
                        localStorage.setItem('homaFoodsToken', this.token);
                        this.showToast('Sign Up successful! Redirecting to dashboard...', 'success');
                        this.hideSignup();
                        this.showDashboard();
                    } else {
                        this.showToast(data.error || 'Sign Up failed!', 'error');
                    }
                } catch (error) {
                    console.error('❌ Signup error:', error);
                    this.showToast('Network error during signup.', 'error');
                } finally {
                    this.showLoading(false);
                }
            }

            async handleLogin(e) {
                console.log('🔍 Handle login called - form submitted!');
                e.preventDefault();
                
                try {
                    const email = document.getElementById('login-email').value;
                    const password = document.getElementById('login-password').value;
                    
                    console.log('🔍 Login data:', { email, password });
                    
                    this.showLoading(true);
                    
                    const response = await fetch(`${this.apiUrl}/auth/login`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ email, password })
                    });
                    
                    const data = await response.json();
                    console.log('🔍 Login response:', data);
                    
                    if (response.ok) {
                        this.token = data.token;
                        localStorage.setItem('homaFoodsToken', this.token);
                        this.showToast('Login successful! Redirecting to dashboard...', 'success');
                        this.hideLogin();
                        this.showDashboard();
                    } else {
                        this.showToast(data.error || 'Login failed!', 'error');
                    }
                } catch (error) {
                    console.error('❌ Login error:', error);
                    this.showToast('Network error during login.', 'error');
                } finally {
                    this.showLoading(false);
                }
            }

            async handleSearch() {
                const query = document.getElementById('search-input').value.trim();
                if (!query) return;

                console.log('🔍 Searching for:', query);
                this.showLoading(true);

                try {
                    const response = await fetch(`${this.apiUrl}/data?search=${encodeURIComponent(query)}`);
                    const data = await response.json();
                    
                    if (response.ok) {
                        this.displaySearchResults(data.foods);
                    } else {
                        this.showToast('Search failed!', 'error');
                    }
                } catch (error) {
                    console.error('❌ Search error:', error);
                    this.showToast('Network error during search.', 'error');
                } finally {
                    this.showLoading(false);
                }
            }

            displaySearchResults(foods) {
                const resultsDiv = document.getElementById('search-results');
                resultsDiv.innerHTML = '';

                if (foods.length === 0) {
                    resultsDiv.innerHTML = '<p class="text-white/70">No foods found. Try a different search term.</p>';
                    return;
                }

                foods.forEach(food => {
                    const foodCard = document.createElement('div');
                    foodCard.className = 'glass rounded-lg p-4 mb-4';
                    foodCard.innerHTML = `
                        <h4 class="text-xl font-semibold text-white mb-2">${food.food_name}</h4>
                        <div class="grid grid-cols-2 gap-4 text-sm text-white/80">
                            <div>Calories: ${food.calories}</div>
                            <div>Protein: ${food.protein_g}g</div>
                            <div>Fat: ${food.fat_g}g</div>
                            <div>Carbs: ${food.carbs_g}g</div>
                        </div>
                        <div class="mt-2">
                            <span class="inline-block px-2 py-1 rounded text-xs ${food.diabetic_rating === 'green' ? 'bg-green-500' : food.diabetic_rating === 'yellow' ? 'bg-yellow-500' : 'bg-red-500'} text-white">
                                ${food.diabetic_rating.toUpperCase()}
                            </span>
                        </div>
                    `;
                    resultsDiv.appendChild(foodCard);
                });
            }

            async loadStats() {
                try {
                    const response = await fetch(`${this.apiUrl}/data/stats`);
                    const data = await response.json();
                    console.log('📊 Database stats:', data);
                } catch (error) {
                    console.error('❌ Stats error:', error);
                }
            }

            checkAuthStatus() {
                if (this.token) {
                    this.showDashboard();
                } else {
                    this.showWelcome();
                }
            }

            logout() {
                this.token = null;
                localStorage.removeItem('homaFoodsToken');
                this.showWelcome();
                this.showToast('Logged out successfully!', 'info');
            }
        }

        // Initialize app when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            console.log('🚀 DOM loaded, initializing HOMA FOODS App...');
            new HomaFoodsApp();
        });
    </script>
</body>
</html>
